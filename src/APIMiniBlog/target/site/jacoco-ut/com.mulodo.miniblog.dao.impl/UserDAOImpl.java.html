<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>UserDAOImpl.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">APIMiniBlog</a> &gt; <a href="index.source.html" class="el_package">com.mulodo.miniblog.dao.impl</a> &gt; <span class="el_source">UserDAOImpl.java</span></div><h1>UserDAOImpl.java</h1><pre class="source lang-java linenums">/* 
 * GenericDAOImpl.java 
 *  
 * 1.0
 * 
 * 2015/02/02
 *  
 * Copyright (c) 2015 Le U Uay
 * 
 */
package com.mulodo.miniblog.dao.impl;

import java.util.ArrayList;
import java.util.List;

import org.hibernate.Criteria;
import org.hibernate.HibernateException;
import org.hibernate.ObjectNotFoundException;
import org.hibernate.criterion.Projections;
import org.hibernate.criterion.Restrictions;
import org.hibernate.transform.Transformers;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.stereotype.Repository;

import com.mulodo.miniblog.contraints.Constraints;
import com.mulodo.miniblog.dao.UserDAO;
import com.mulodo.miniblog.exeption.HandlerException;
import com.mulodo.miniblog.model.User;

/**
 * The user dao impl
 * 
 * @author UayLU
 * 
 */
@Repository(&quot;userDAO&quot;)
<span class="fc" id="L38">public class UserDAOImpl extends GenericDAOImpl&lt;User&gt; implements UserDAO{</span>

<span class="fc" id="L40">	private static final Logger logger = LoggerFactory.getLogger(UserDAOImpl.class);</span>
	
	
	/**
	 *  isUserExits use to check exist user in database
	 *	
	 *	@param	username : string username use to check
	 *
	 *	@return Boolean
	 *	
	 *	
	 *  @exception  HandlerException
	 */
	@Override
	public Boolean isUserExits(String username) throws HandlerException {
		try{
			
<span class="fc" id="L57">	        session = this.sessionFactory.openSession();</span>
<span class="fc" id="L58">	        tx = session.beginTransaction();</span>
<span class="fc" id="L59">	        Criteria criteria = session.createCriteria(User.class);</span>
	        
<span class="pc bpc" id="L61" title="1 of 2 branches missed.">	        if(username != null){</span>
<span class="fc" id="L62">	        	criteria.add(Restrictions.eq(&quot;username&quot;,username));</span>
	        }
	        
<span class="fc bfc" id="L65" title="All 2 branches covered.">	        if(criteria.list().isEmpty()){</span>
<span class="fc" id="L66">	        	return false;</span>
	        }
<span class="fc" id="L68">	        User user = (User) criteria.list().get(0);</span>
<span class="fc" id="L69">	        logger.info(&quot;Check user successfully,  details=&quot;+user.getId());</span>
<span class="fc" id="L70">	        tx.commit();</span>
<span class="pc bpc" id="L71" title="2 of 4 branches missed.">	        return user.getId() != 0 &amp;&amp; user.getUsername().equals(username);</span>
	   
<span class="nc" id="L73">    	}catch(HibernateException ex){</span>
<span class="nc" id="L74">    		throw new HandlerException(ex.getMessage());</span>
<span class="nc" id="L75">    	}finally {</span>
<span class="pc" id="L76">    		   session.close();</span>
<span class="nc" id="L77">    	}</span>
	}

	/**
	 *  is_email_exits use to check exist email in database
	 *	
	 *	@param	email : email for check
	 *  @param  user  : check email but not check email for this user
	 *
	 *	@return Boolean
	 *	
	 *	
	 *  @exception  HandlerException
	 */
	@Override
	public Boolean isEmailExits(String email, User user) throws HandlerException {
		
		try{
			
<span class="fc" id="L96">	        session = this.sessionFactory.openSession();</span>
<span class="fc" id="L97">	        tx = session.beginTransaction();</span>
<span class="fc" id="L98">	        Criteria criteria = session.createCriteria(User.class);</span>
	        
<span class="pc bpc" id="L100" title="1 of 2 branches missed.">	        if(email != null){</span>
<span class="fc" id="L101">	        	criteria.add(Restrictions.eq(&quot;email&quot;,email));</span>
	        }
	        
<span class="fc bfc" id="L104" title="All 2 branches covered.">	        if(criteria.list().isEmpty()){</span>
<span class="fc" id="L105">	        	return false;</span>
	        }
<span class="fc" id="L107">	        User userDB = (User) criteria.list().get(0);</span>
	        
<span class="fc" id="L109">	        tx.commit();</span>
<span class="pc bpc" id="L110" title="1 of 4 branches missed.">        	return !(user != null &amp;&amp; user.getId() == userDB.getId());</span>
	        
<span class="nc" id="L112">    	}catch(HibernateException ex){</span>
<span class="nc" id="L113">    		ex.printStackTrace();</span>
<span class="nc" id="L114">    		throw new HandlerException(ex.getMessage());</span>
<span class="nc" id="L115">    	}finally {</span>
<span class="pc" id="L116">    		   session.close();</span>
<span class="nc" id="L117">    	}</span>
	}

	/**
	 *  isValidLogin check valid login
	 *	
	 *	@param	username : username for login
	 *  @param  password : password for login
	 *
	 *	@return User
	 *	
	 *	
	 *  @exception  HandlerException
	 */
	@Override
	public User isValidLogin(String username, String password) throws HandlerException{
		try{
<span class="fc" id="L134">			User user = null;</span>
			 
<span class="fc" id="L136">	        session = this.sessionFactory.openSession();</span>
<span class="fc" id="L137">	        tx = session.beginTransaction();</span>
<span class="fc" id="L138">	        Criteria criteria = session.createCriteria(User.class);	        </span>
	        
<span class="fc" id="L140">        	criteria.add(Restrictions.eq(&quot;username&quot;,username));</span>
<span class="fc" id="L141">        	criteria.add(Restrictions.eq(&quot;password&quot;,password));</span>
	        
<span class="fc bfc" id="L143" title="All 2 branches covered.">	        if(!criteria.list().isEmpty()){</span>
<span class="fc" id="L144">	        	user = (User) criteria.list().get(0);</span>
<span class="fc" id="L145">	        	logger.info(&quot;Person loaded successfully, Person details=&quot;+user);		        </span>
	        }
	       
<span class="fc" id="L148">	        tx.commit();</span>
<span class="fc" id="L149">	        return user;</span>
<span class="nc" id="L150">		}catch(HibernateException ex){</span>
<span class="nc" id="L151">			tx.rollback();</span>
<span class="nc" id="L152">			throw new HandlerException(ex.getMessage());</span>
<span class="nc" id="L153">		}finally {</span>
<span class="pc" id="L154">			   session.close();</span>
<span class="nc" id="L155">		}</span>
	}

	/**
	 *  find_by_name use for find user in database
	 *	
	 *	@param	name : name of username, firstname, lastname
	 *
	 *	@return List&lt;User&gt;
	 *	
	 *	
	 *  @exception  HandlerException
	 */
	@SuppressWarnings(&quot;unchecked&quot;)
	@Override
	public List&lt;User&gt; findByName(String name) throws HandlerException {
		try{
<span class="fc" id="L172">	        session = this.sessionFactory.openSession();</span>
	        
<span class="fc" id="L174">	        Criteria criteria = session.createCriteria(User.class);</span>
	        
<span class="fc" id="L176">        	criteria.add(Restrictions.disjunction()</span>
<span class="fc" id="L177">	        			.add(Restrictions.like(&quot;username&quot;, &quot;%&quot;+name+&quot;%&quot;))</span>
<span class="fc" id="L178">	        			.add(Restrictions.like(&quot;firstname&quot;,&quot;%&quot;+name+&quot;%&quot;))</span>
<span class="fc" id="L179">	        			.add(Restrictions.like(&quot;lastname&quot;,&quot;%&quot;+name+&quot;%&quot;)))</span>
<span class="fc" id="L180">	        		.add(Restrictions.eq(&quot;status&quot;,Constraints.USER_ACTIVE))</span>
<span class="fc" id="L181">        			.setProjection(Projections.projectionList()</span>
<span class="fc" id="L182">        			      .add(Projections.property(&quot;id&quot;), &quot;id&quot;)</span>
<span class="fc" id="L183">        			      .add(Projections.property(&quot;username&quot;), &quot;username&quot;)</span>
<span class="fc" id="L184">        			      .add(Projections.property(&quot;firstname&quot;), &quot;firstname&quot;)</span>
<span class="fc" id="L185">        			      .add(Projections.property(&quot;lastname&quot;), &quot;lastname&quot;)</span>
<span class="fc" id="L186">        			      .add(Projections.property(&quot;status&quot;), &quot;status&quot;)</span>
<span class="fc" id="L187">        			      .add(Projections.property(&quot;email&quot;), &quot;email&quot;))</span>
<span class="fc" id="L188">        			.setResultTransformer(Transformers.aliasToBean(User.class));</span>
        
<span class="fc" id="L190">	        List&lt;User&gt; usersList = new ArrayList&lt;User&gt;();</span>
<span class="pc bpc" id="L191" title="1 of 2 branches missed.">	        if(!criteria.list().isEmpty()){</span>
<span class="fc" id="L192">		        usersList = criteria.list();</span>
<span class="fc bfc" id="L193" title="All 2 branches covered.">		        for(User us : usersList){</span>
<span class="fc" id="L194">		            logger.info(&quot;Person List::&quot;+us);</span>
		        }
	        }
<span class="fc" id="L197">	        return usersList;</span>
<span class="nc" id="L198">    	}catch(HibernateException ex){</span>
<span class="nc" id="L199">    		throw new HandlerException(ex.getMessage());</span>
<span class="nc" id="L200">    	}finally {</span>
<span class="pc" id="L201">    		   session.close();</span>
<span class="nc" id="L202">    	}</span>
	}

	
	/**
	 *  deleteByUsername use to check delete user by username in database
	 *	
	 *	@param	username : string username use to check
	 *
	 *	@return Boolean
	 *	
	 *	
	 *  @exception  HandlerException
	 */
	@Override
	public Boolean deleteByUsername(String username) throws HandlerException {
		try{ 
<span class="fc" id="L219"> 	        session = this.sessionFactory.openSession();</span>
<span class="fc" id="L220"> 	        tx = session.beginTransaction();</span>
<span class="fc" id="L221">			Criteria criteria = session.createCriteria(User.class);</span>
			
<span class="fc" id="L223">        	criteria.add(Restrictions.eq(&quot;username&quot;,username));</span>
<span class="fc bfc" id="L224" title="All 2 branches covered.">        	if(criteria.list().isEmpty()){</span>
<span class="fc" id="L225">				return false;</span>
			}else{
<span class="fc" id="L227">				User user = (User) criteria.list().get(0);</span>
<span class="fc" id="L228">				session.delete(user);</span>
<span class="fc" id="L229">	 	        tx.commit();</span>
<span class="fc" id="L230">	 	        logger.info(&quot;User deleted successfully, user details=&quot;+user);</span>
<span class="fc" id="L231">	 	        return true;</span>
			}

<span class="nc" id="L234">     	}catch(HibernateException ex){</span>
<span class="nc" id="L235"> 			tx.rollback();</span>
<span class="nc" id="L236">     		throw new HandlerException(ex.getMessage());</span>
<span class="nc" id="L237">     	}finally {</span>
<span class="pc" id="L238">     		session.close();</span>
<span class="nc" id="L239">     	}</span>
	}

	
	/**
	 *  findByUsername use to check search user by username in database
	 *	
	 *	@param	username : string username use to search
	 *
	 *	@return Boolean
	 *	
	 *	
	 *  @exception  HandlerException
	 */
	@Override
	public User findByUsername(String username) throws HandlerException {
<span class="fc" id="L255">		User user = null;</span>
		
		try{ 
<span class="fc" id="L258"> 	        session = this.sessionFactory.openSession();</span>
<span class="fc" id="L259"> 	        tx = session.beginTransaction();</span>
<span class="fc" id="L260">			Criteria criteria = session.createCriteria(User.class);</span>
<span class="fc" id="L261">        	criteria.add(Restrictions.eq(&quot;username&quot;,username));</span>
<span class="pc bpc" id="L262" title="1 of 2 branches missed.">        	if(!criteria.list().isEmpty()){</span>
<span class="fc" id="L263">        		user = (User) criteria.list().get(0);</span>
<span class="fc" id="L264">	 	        tx.commit();</span>
<span class="fc" id="L265">	 	        logger.info(&quot;Find user successfully, user details=&quot;+user);</span>
			}
<span class="fc" id="L267">			return user;</span>
<span class="nc" id="L268">     	}catch(HibernateException ex){</span>
<span class="nc" id="L269">     		logger.info(&quot;Hibernate exception, Details=&quot;+ex.getMessage());</span>
<span class="nc" id="L270"> 			tx.rollback();</span>
<span class="nc" id="L271">     		throw new HandlerException(ex.getMessage());</span>
<span class="nc" id="L272">     	}finally {</span>
<span class="pc" id="L273">     		session.close();</span>
<span class="nc" id="L274">     	}</span>
	}	
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.2.201409121644</span></div></body></html>